# Modelling PSR J0437-4715 NICER data

## Overview

Modules required to simulate and model observations from NASA's NICER mission of the neutron star PSR J0437-4715 associated with the publication "A NICER View of the Nearest and Brightest Millisecond Pulsar: PSR J0437â€“4715" by Choudhury et al. (2024; [ApJL 971 L20](https://doi.org/10.3847/2041-8213/ad5a6f); [arXiv:2407.06789](https://doi.org/10.48550/arXiv.2407.06789)).

This repository provides Python modules for pulse profile modelling with the [X-PSI](https://github.com/xpsi-group/xpsi) framework along with Jupyter notebooks for analysing data products corresponding to observations of PSR J0437-4715 using numerical model files including the telescope calibration products for NASA's NICER and XMM-Newton telescopes, hosted in this [Zenodo repository](https://zenodo.org/records/13766753). The Zenodo repository also hosts the output files generated by these modules. 


## Software

Each directory in this repository consists of modules corresponding to a specific model explored in the paper. The modules call routines of the [X-PSI](https://github.com/xpsi-group/xpsi) software to model the data, infer the neutron star parameters, and postprocess the output. For the inference runs, versions range from `v0.7.0` to `v1.2.1`. In all cases, X-PSI was installed using the numerical atmosphere extension. The final postprocessing scripts (producing most of the figures in the paper) were run using `v2.2.2` of X-PSI. It is generally recommended to use more up-to-date versions of X-PSI.

## Analysis scripts for inference runs

All the module directories (e.g. ``CST_PDT/_auto_modules/``) include main files (named e.g., ``main_3C50_BKG_AGN_smooth_3sigma.py``), which are the scripts used to obtain the posterior samples in the computer cluster. The other Python scripts (e.g. ``CustomPhotosphere.py`` etc.) that the main scripts import are also included in the same directory. The job is submitted to the cluster using a batch script. An example batch script ``example_job_script.sh`` has been provided. To experiment with the scripts locally, one could do it by going to the model directory (e.g. ``CST_PDT/``) and running e.g. ``python _auto_modules/main_3C50_BKG_AGN_smooth_3sigma.py @config_3C50_BKG_AGN.ini``.

The full list of all the main scripts saved in this package is presented below:

* ``CST_PDT/_auto_modules/main_3C50_BKG_AGN_smooth_3sigma_hiMN_lowXPSI.py``: The headline high resolution NICER-only (3C50) CST+PDT run including lower and upper background limits (involving AGN estimate) with 20,000 live points.
* ``CST_PDT/_auto_modules/main_3C50_NoBKG_hiMN_lowXPSI.py``: NICER-only (3C50) high resolution CST+PDT run involving no background constraints with 20,000 live points.
* ``CST_PDT/_auto_modules_NICERxXMM/main.py``: Joint NICER (3C50) and XMM CST+PDT run involving both lower and upper limits for both instruments with 4000 live points.
* ``CST_PDT/_auto_modules/main_3C50_BKG_AGN_smooth_3sigma.py``: NICER-only (3C50) CST+PDT including lower and upper background limits (involving AGN estimate) with 4000 live points.
* ``CST_PDT/_auto_modules/main_3C50_BKG_lower_smooth_3sigma.py``: NICER-only (3C50) CST+PDT including only a lower background limit (involving AGN estimate) with 4000 live points.
* ``CST_PDT/_auto_modules/main_3C50_NoBKG.py``: NICER-only (3C50) CST+PDT run involving no background constraints with 4000 live points.
* ``CST_PDT/_auto_modules/main_3C50_NoBKG_NoRadio_beta_param.py``: NICER-only (3C50) CST+PDT run involving no background constraints or radio priors with 4000 live points.
* ``ST_PDT/_auto_modules/main_3C50_BKG_AGN_smooth_3sigma.py``: NICER-only (3C50) ST+PDT including lower and upper background limits (involving AGN estimate) with 2000 live points.
* ``ST_PDT/_auto_modules/main_3C50_BKG_lower_smooth_3sigma.py``: NICER-only (3C50) ST+PDT including only a lower background limit (involving AGN estimate) with 2000 live points.
* ``ST_PDT/_auto_modules/main_3C50_NoBKG.py``: NICER-only (3C50) ST+PDT run involving no background constraints with 2000 live points.
* ``ST_PDT/Delta_modules/main.py``: NICER-only (Delta) ST+PDT including only a lower background limit (involving AGN estimate) with 8000 live points.
* ``ST_U/_auto_modules/main_3C50_BKG_DeltaAGN_smooth_3sigma.py``: NICER-only (3C50) ST-U including lower and upper background limits (involving AGN estimate) with 2000 live points.
* ``ST_U/_auto_modules/main_3C50_BKG_DeltaAGN_lower_smooth_3sigma.py``: NICER-only (3C50) ST-U including only a lower background limit (involving AGN estimate) with 2000 live points.
* ``ST_U/_auto_modules/main_3C50_BKG_lower_1sigma.py``: NICER-only (3C50) ST-U including only a lower background limit (testing $n_l = 1$) with 2000 live points. 
* ``ST_U/_auto_modules/main_3C50_BKG_lower_2sigma.py``: NICER-only (3C50) ST-U including only a lower background limit (testing $n_l = 2$) with 2000 live points. 
* ``ST_U/_auto_modules/main_3C50_BKG_lower_3sigma.py``: NICER-only (3C50) ST-U including only a lower background limit (testing $n_l = 3$) with 2000 live points. 
* ``ST_U/_auto_modules/main_3C50_BKG_lower_4sigma.py``: NICER-only (3C50) ST-U including only a lower background limit (testing $n_l = 4$) with 2000 live points. 
* ``ST_U/_auto_modules/main_3C50_BKG_lower_smooth_3sigma``: NICER-only (3C50) ST-U including only a lower background limit (testing $n_l = 3$, smoothed) with 2000 live points. 
* ``ST_U/_auto_modules/main_3C50_NoBKG.py``: NICER-only (3C50) ST-U run involving no background constraints with 2000 live points.
* ``ST_U/Delta_XMM_modules/main_Delta_XMM.py``: Joint NICER (Delta) and XMM ST-U run involving both lower and upper limits for XMM with 4000 live points.
* ``ST_U/Delta_elsewhere_SW_modules/main_Delta_elsewhere_SW.py``: NICER-only (Delta) ST-U run including a lower background limit and ``elsewhere`` component with 4000 live points.
* ``ST_U/Delta_NoBkg_modules/main_Delta_NoBkg.py``: NICER-only (Delta) ST-U run involving no background limits with 4000 live points.

## Figures and Tables

The figures of the publication, corresponding to this repository, can be reproduced using the notebooks found here. Once the repository has been downloaded and X-PSI installed, these notebooks can be run without further changes. Here we list which notebooks should be executed to produce each of them (the pre-executed figures can also be viewed in the notebooks). Note that the notebooks also contain additional figures, not reported in the paper, to aid with further exploration. The cell blocks to be executed to obtain the figures in the paper have been described in in-line markdown cells.
* ``ST_U/postprocessing_metadata_ST_U_Delta.py``: Figure B.1 (ApJL; numbered 17 in arXiv).
* ``ST_U/postprocessing_ST_U_3C50.ipynb``: Figures 3, 4, 5, B.2 (ApJL; numbered 18 in arXiv), B.3 (ApJL; numbered 10 in arXiv).
* ``ST_PDT/postprocessing_ST_PDT_Delta_SW.ipynb``: Figure B.4 (ApJL; numbered 20 in arXiv).
* ``ST_PDT/postprocessing_ST_PDT_3C50.ipynb``: Figures 6, 7, B.5 (ApJL; numbered 21 in arXiv).
* ``CST_PDT/postprocessing_CST_PDT_3C50.ipynb``: Figures 8, 9, 10, 11, 12, 13, 14, 15, B.6 (ApJL; numbered 22 in arXiv), B.7 (ApJL; numbered 23 in arXiv).

There is no single script to obtain the numerical values shown in Table A.1 (ApJL; nunmbered 4 in arXiv). However, the information shown is based on outputs of the analysis notebook ``CST_PDT/postprocessing_CST_PDT_3C50.ipynb``

## Contact

If you have questions, comments, or requests, please contact:
Devarshi Choudhury, D.Choudhury@uva.nl,
(in cc) Anna L. Watts, A.L.Watts@uva.nl
